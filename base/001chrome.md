>  https://time.geekbang.org/column/article/116572


## 1. 浏览器架构

![浏览器进程](../_media/chrome.jpeg)


## 2. 跨站脚本攻击（XSS）

XSS 的攻击方式是黑客往用户的页面中注入恶意脚本，然后再通过恶意脚本将用户页面的数据上传到黑客的服务器上，最后黑客再利用这些数据进行一些恶意操作。

### 1. 存储型 XSS 攻击

- 首先黑客利用站点漏洞将一段恶意 JavaScript 代码提交到网站的数据库中；

- 然后用户向网站请求包含了恶意 JavaScript 脚本的页面；

- 当用户浏览该页面的时候，恶意脚本就会将用户的 Cookie 信息等数据上传到服务器。


### 2. 反射型 XSS 攻击

- 用户将一段含有恶意代码的请求提交给 Web 服务器，Web 服务器接收到请求时，又将恶意代码反射给了浏览器端

- Web 服务器不会存储反射型 XSS 攻击的恶意脚本，这是和存储型 XSS 攻击不同的地方。


### 3. 基于 DOM 的 XSS 攻击

基于 DOM 的 XSS 攻击是不牵涉到页面 Web 服务器的。具体来讲，黑客通过各种手段将恶意脚本注入用户的页面中，比如通过网络劫持在页面传输过程中修改 HTML 页面的内容，这种劫持类型很多，有通过 WiFi 路由器劫持的，有通过本地恶意软件来劫持的，它们的共同点是在 Web 资源传输过程或者在用户使用页面的过程中修改 Web 页面的数据。


### 4. 如何阻止 XSS 攻击

1. 服务器对输入脚本进行过滤或转码

2. 充分利用 CSP （使用https、来源域）

3. 使用 HttpOnly 属性（这样js就无法获取到cookie了）

4. 添加验证码防止脚本冒充用户提交危险操作

5. 对于一些不受信任的输入，还可以限制其输入长度



## 3. 首屏显示

- DNS

- HTTP

- DOM 解析

- CSS 阻塞

- JavaScript 阻塞等

其中一项没处理好就可能导致整个页面的延时。


## 4. 禁止网站被iframe嵌套

`防止别人镜像自己的网站！`

在响应头里加一个X-Frame-Options: 

- DENY：浏览器拒绝当前页面加载任何Frame页面

- SAMEORIGIN：frame页面的地址只能为同源域名下的页面

- ALLOW-FROM origin：origin为允许frame加载的页面地址


## 5. CSRF/XSRF

CSRF 攻击不需要将恶意代码注入用户的页面，仅仅是利用服务器的漏洞和用户的登录状态来实施攻击。


**发起 CSRF 攻击的三个必要条件：**

- 目标站点一定要有 CSRF 漏洞

- 用户要登录过目标站点，并且在浏览器上保持有该站点的登录状态

- 需要用户打开一个第三方站点，可以是黑客的站点，也可以是一些论坛


**避免遭受到 CSRF 攻击：**

- 充分利用好 Cookie 的 SameSite 属性

- 验证请求的来源站点

- CSRF Token （如果是从第三方站点发出的请求，那么将无法获取到 CSRF Token 的值）


Q：在浏览器打开第三方站点是如何拿到极客时间站点cookie的？第三方站点和极客时间的站点不同，存在同源策略，所以转账请求验证cookie也是不通过的，那么CSRF是如何攻击的呢？

A1：浏览器处理cookie的机制，做某个域的请求，自动会把这个域的cookie带上。

A2：默认时间是浏览器关闭，但是可以自定义生命周期时长

A3：第三方cookie了解一下。第三方网址只需要负责发起即刻时间的转账接口，接口发起的时候会带上浏览器中保存的本站cookie，此时cookie是作为第三方cookie带上的，所以第三方压根不需要获取你的cookie，浏览器自动会带上。这也是samesite的作用，禁止本cookie作为第三方cookie。

A4：同源策略并没有完全限制网站不能使用非同源的资源，比如引用第三方script文件，引用第三方CSS文件等，同样的，也没有限制一些跨域写操作，比如表单提交。因此，光靠同源策略不能阻止CSRF。


## 6. 浏览器缓存

（1）浏览器缓存分为强缓存和协商缓存，强缓存会直接从浏览器里面拿数据，协商缓存会先访问服务器看缓存是否过期，再决定是否从浏览器里面拿数据。

（2）强缓存的字段有：Expires（http1.0）和Cache-Control（http1.1）

（3）协商缓存的字段是：Last-Modified / If-Modified-Since 和 Etag / If-None-Match，其中 Etag / If-None-Match的优先级比Last-Modified / If-Modified-Since高。